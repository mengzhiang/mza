/*
Copyright 2010, KISSY UI Library v1.1.6
MIT Licensed
build time: Dec 14 18:01
*/
KISSY.add("cookie",function(e){var h=document,i=encodeURIComponent,j=decodeURIComponent;e.Cookie={get:function(b){var a;if(e.isString(b)&&b!=="")if(b=h.cookie.match("(?:^| )"+b+"(?:(?:=([^;]*))|;|$)"))a=b[1]?j(b[1]):"";return a},set:function(b,a,f,d,g,k){a=i(a);var c=f;if(typeof c==="number"){c=new Date;c.setTime(c.getTime()+f*864E5)}if(c instanceof Date)a+="; expires="+c.toUTCString();if(e.isString(d)&&d!=="")a+="; domain="+d;if(e.isString(g)&&g!=="")a+="; path="+g;if(k)a+="; secure";h.cookie=b+
"="+a},remove:function(b,a,f,d){this.set(b,"",0,a,f,d)}}});/*pub-2|2011-10-26 09:55:33*/MFP.add("lottery",function(a){function F(){if(b.UA.ie)h.body.style.behavior="url(#default#homepage)",h.body.setHomePage("http://www.tmall.com");else if(i.sidebar){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(a){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u7981\u7528\u4e86\u81ea\u52a8\u8bbe\u7f6e\u9996\u9875\u529f\u80fd\uff0c\u8bf7\u624b\u52a8\u8bbe\u7f6e\uff01")}var c=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);c.setCharPref("browser.startup.homepage","http://www.tmall.com")}else alert("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u81ea\u52a8\u8bbe\u7f6e\u9996\u9875\u529f\u80fd\uff0c\u8bf7\u624b\u52a8\u8bbe\u7f6e\uff01")}function G(a,b,c){a||(a=h.getElementById(D.submitBtnID)),c=c||location.href,b=b||document.title;var d,e,f=i.external,g=i.sidebar;a.setAttribute("rel","sidebar"),f&&typeof f.AddFavorite!="undefined"?f.AddFavorite(c,b):g&&g.addPanel||j?(a.href=c,a.title=b):(e="\u7531\u4e8e\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u81ea\u52a8\u8bbe\u7f6e\u529f\u80fd\n\u73b0\u5728\u6dfb\u52a0\u6536\u85cf\u5939 \uff0c\u6bcf\u5929\u4e0atmall.com\u62ff\u5343\u5143\u73b0\u91d1\u7ea2\u5305\n\uff08\u5feb\u6377\u952e\uff1a"+(d?"Cmd":"Ctrl")+"+D)",alert(e))}function H(){if(J(x))return;var a=new Date;y=a.getFullYear(),m=a.getMonth(),d=a.getDate()+1,timeout=new Date(y,m,d,0,0,0),g.set(x,A,timeout)}function I(){if(J(z))return;var a=new Date;y=a.getFullYear(),m=a.getMonth(),d=a.getDate()+7,timeout=new Date(y,m,d,0,0,0),g.set(z,A,timeout)}function J(a){var b=g.get(a);return b&&b==A}function K(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}function L(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function M(){var a=b.UA.ie<9?i[p]:h[p];a.lao()}function N(a,c){if(!(this instanceof N))return new N;var d=this;d.config=b.merge(E,a||{}),d.msgBox=null,d.requestTime=0,d.init(c)}function O(a){var c=this;if(c instanceof O)a=b.merge(D,a||{}),c.config=a,c.anim={},c.content=null,c.closeBtn=null,c.contentText=null,c.submitBtn=null,c.contentTip=null,c.init();else return new O(a)}var b=KISSY,c=b.DOM,e=b.Event,f=b.get,g=b.Cookie,h=document,i=window,j=!!b.UA.opera,k=navigator.appVersion.indexOf("Mac")>-1,l=b.UA.ie==6,n=!!b.UA.ie,o=location.href.indexOf("demo.ued.taobao.net")!=-1,p="J_TmallFlash",q="J_Logout",r="user-nick",s="login-info",t="http://login.tmall.com",u="http://"+(o?"promotion.daily.taobao.net":"promotion.taobao.com")+"/tcp/takeOutAward.do",v="https://hongbao.alipay.com/coupon/index.htm",w="http://member1.taobao.com/member/fresh/deliver_address.htm",x="alertbox",z="tipbox",A="close",B=100,C=["login.tmall.com","login.daily.taobao.net"],D={contentID:"J_EggMsgBox",closeBtnCls:"j_EggCloseBtn",contentTextCls:"j_EggContentText",submitBtnID:"J_EggSubmitBtn",contentTipCls:"J_EggContentTip",flashID:"J_EggFlash",offset:[0,0],adLink:"",adText:"",promotionLink:"",tipBoxLink:"http://www.tmall.com/go/act/tmall/sr-youli.php?ad_id=&am_id=1300605831f70ca5ffb5&cm_id=&pm_id=",bgImg:["http://img04.taobaocdn.com/tps/i4/T1ZPysXlJfXXXXXXXX-320-194.png","http://img02.taobaocdn.com/tps/i2/T1YjysXlRfXXXXXXXX-320-194.png","http://img03.taobaocdn.com/tps/i3/T146ysXk8fXXXXXXXX-320-194.png","http://img01.taobaocdn.com/tps/i1/T1J6usXkFfXXXXXXXX-320-194.png",l?"http://img04.taobaocdn.com/tps/i4/T1cHCuXatsXXXXXXXX-243-159.png":"http://img04.taobaocdn.com/tps/i4/T1bequXX4cXXXXXXXX-243-159.png"]},E={ruleId:562,objId:"",type:2,time:"",checkCode:"",result:b.guid("result_")};b.augment(N,{isLogoin:function(){return!!f("#"+q)},getNickName:function(){var a=f("#"+s+" ."+r),b=a?c.text(a):i.userCookie._nk_;return b},isDirectVisit:function(){var a=document.referrer,b=location.search;if(b.indexOf("from=wangwang")!=-1)a=b="";else for(var c=0;c<C.length;c++)a.indexOf(C[c])!=-1&&(a="");return a==""&&b==""},startLottery:function(){function d(){var b=a.msgBox;n?b.changeStyle(3,"ie",F):b.changeStyle(3,"other",G)}var a=this,c=a.config;url=u+"?ruleId={ruleId}&objId={objId}&type={type}&time={time}&checkCode={checkCode}&result={result}",url=b.substitute(url,c),b.getScript(url,{success:function(){var b=i[c.result],e=a.msgBox;if(!b||!b.is_success)return a.requestTime<3?(setTimeout(function(){a.startLottery.call(a)},500),a.requestTime++):d(),!1;if(b.is_success=="T"){var f=a.getNickName()||"";if(!b.user)d();else{var g=b.user[0].value;e.changeStyle(2,g,v,f)}}else a.error(b.error),d();H(),e=null},error:function(){d()},timeout:3})},error:function(a){switch(a){case"E019":alert("\u5c0f\u4e8c\u7528\u6237\u7981\u6b62\u62bd\u5956!");break;case"E015":alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u4eca\u5929\u62bd\u5956\u6b21\u6570\u8fc7\u591a\uff0c\u8bf7\u660e\u5929\u518d\u8bd5\uff01");break;case"E016":alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u672c\u6b21\u6d3b\u52a8\u62bd\u5956\u5df2\u8fbe\u6700\u5927\u6b21\u6570\uff0c\u8c22\u8c22\u652f\u6301\uff01")}},init:function(a){var b=this;if(!J(x)&&b.isDirectVisit()){var c=b.msgBox=new O(a);isShow=!0,b.isLogoin()?c.changeStyle("","",function(){b.startLottery.call(b)}):c.changeStyle(1),location.href.indexOf("from=wangwang")>0&&c.setFromWangWangTitle()}else if(!J(z)&&!b.isDirectVisit()){var c=b.msgBox=new O(a);isShow=!0,c.changeStyle(4)}!c||setTimeout(function(){c.show(),c.slideIn()},B)}}),b.augment(O,{init:function(){var a=this,d=a.config,f;a.content||a.create(),f=a.content=b.one("#"+d.contentID),a.closeBtn=f.one("."+d.closeBtnCls),a.contentText=f.one("."+d.contentTextCls),a.submitBtn=f.one("#"+d.submitBtnID),a.contentTip=f.one("."+d.contentTipCls),a.hide(),e.on(a.closeBtn,"click",function(b){b.halt(),a.slideOut(),c.hasClass(a.closeBtn,"closeTipBox")?I():H()})},create:function(){var a=this,b=a.config,d,e="";e+='<div class="easeterEggs" id="'+b.contentID+'">',e+='<a class="easeterEggs-close '+b.closeBtnCls+'" href="#">\u5173\u95ed</a>',e+='<p class="easeterEggs-text '+b.contentTextCls+'"></p>',e+='<p class="easeterEggs-tip '+b.contentTipCls+'"></p>',e+='<a href="#" class="easeterEggs-btn" id= "'+b.submitBtnID+'"></a>',e+='<a class="easeterEggs-detail" href="'+b.promotionLink+'">\u6d3b\u52a8\u8be6\u60c5>></a>',e+='<a class="easeterEggs-ad" href="'+b.adLink+'">'+b.adText+"</a>",d=c.create(e),c.append(d,"body")},remove:function(){c.remove(this.content),c.remove(this.flash)},slideIn:function(){var a=this,d=a.config,f=a.anim,g=a.content,j=d.offset[1],k=d.offset[0];setTimeout(function(){f.slideIn=new b.Anim(g,{bottom:j+"px"},.3,"easeOut"),f.slideOut&&f.slideOut.stop(),f.slideIn.run(),l&&e.on(i,"scroll",function(){var a=c.viewportHeight(h),b=+c.scrollTop(h),e=b+a-d.offset[1]-c.height(g);c.css(g,"top",e)})},800)},slideOut:function(){var a=this,d=a.config,e=a.anim,f=a.content,g=+c.height(f),h=parseInt(c.css(f,"top")),i=l?{top:h+g+d.offset[1]+"px"}:{bottom:0-g+"px"};l&&c.css(f,"top",h+"px"),e.slideOut=new b.Anim(f,i,.3,"easeIn"),e.slideIn&&e.slideIn.stop(),e.slideOut.run(),setTimeout(function(){l?a.remove():setTimeout(function(){a.remove()},400)},800)},hide:function(){c.hide(this.content)},show:function(){c.show(this.content)},changeStyle:function(a,b,d,e){var f=this,g=this.content,d,h="_blank",i=f.config.bgImg[a];!i||((new Image).src=i);switch(a){case 1:d=location.href.indexOf("demo.ued.taobao.net")!=-1?"http://login.daily.taobao.net/member/login.jhtml?redirect_url="+location.href:"http://login.tmall.com/?redirect_url=http%3A%2F%2Fwww.tmall.com%2F",h="_self",c.css(f.submitBtn,"width","175px");break;case 2:c.addClass(g,"minBox");var j=e+"\uff0c\u60a8\u83b7\u5f97\u4e86"+b+"\u5143\u73b0\u91d1\u7ea2\u5305\u3002";b+="\u5143\u7ea2\u5305",c.css(f.submitBtn,"width","75px"),c.text(f.contentTip,j),c.text(f.contentText,b);break;case 3:c.addClass(g,"minBox"),b=="ie"?c.text(f.submitBtn,"\u8bbe\u4e3a\u4e3b\u9875\u6bcf\u5929\u635e"):c.text(f.submitBtn,"\u52a0\u4e3a\u6536\u85cf\u6bcf\u5929\u635e");break;case 4:c.addClass(g,"tipsBox"),c.attr(".easeterEggs-detail","href",f.config.tipBoxLink),c.addClass(f.closeBtn,"closeTipBox");break;default:i=f.config.bgImg[0],c.css(g,"backgroundImage","url("+i+")")}c.css(g,"backgroundImage","url("+i+")"),f.setLinkAction(d,h)},setLinkAction:function(a,b){var d=this,e=h.getElementById(this.config.submitBtnID);typeof a=="string"?(e.setAttribute("href",a),e.setAttribute("target",b),e.onclick=function(){return}):typeof a=="function"&&(c.removeAttr(d.submitBtn,"href"),e.setAttribute("target","_self"),e.onclick=function(b){a()})},setFromWangWangTitle:function(){var a=c.create('<div style="top:45px;left:30px;width:303px;height:32px;position:absolute;background:url(http://img04.taobaocdn.com/tps/i4/T11yevXl9XXXXXXXXX-303-32.png);"></div>');c.append(a,this.content)}}),a.Lottery=N});